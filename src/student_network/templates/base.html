<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <!-- SEO Meta Tags -->
  <meta property="og:site_name" content="HSA Connect" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{{ request.url }}" />

  <!-- Favicon -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/logo/chatboxes_stretch_png_square.png') }}" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
    type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/components/icon.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/semantic.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='styles/mobile.css') }}" />

  <title>HSA Connect | {% block title %}{% endblock %}</title>

  <style type="text/css">
    :root {
      /* Gradient color scheme - Increased contrast */
      --primary: #1a56db;
      /* Darker blue for better contrast */
      --primary-light: rgba(26, 86, 219, 0.15);
      --primary-hover: rgba(26, 86, 219, 0.25);
      --secondary: #7928ca;
      /* Deeper purple */
      --secondary-light: rgba(121, 40, 202, 0.15);
      --secondary-hover: rgba(121, 40, 202, 0.25);
      --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
      --light-gradient: linear-gradient(135deg, rgba(26, 86, 219, 0.15), rgba(121, 40, 202, 0.15));
      --dark-gradient: linear-gradient(135deg, #154ab1, #6422a4);

      /* Brand colors - Enhanced for better contrast */
      --success: #16a34a;
      /* Darker green */
      --success-light: rgba(22, 163, 74, 0.15);
      --danger: #dc2626;
      /* More vibrant red */
      --danger-light: rgba(220, 38, 38, 0.15);
      --warning: #ea580c;
      /* Darker orange */
      --warning-light: rgba(234, 88, 12, 0.15);
      --info: #0284c7;
      /* Darker blue */
      --info-light: rgba(2, 132, 199, 0.15);

      /* Text and background colors - Increased contrast */
      --text-dark: #111827;
      /* Nearly black for maximum contrast */
      --text-medium: #374151;
      /* Darker medium text */
      --text-light: #6b7280;
      /* Darker light text for better readability */
      --bg-light: #f8fafc;
      /* Slightly colder white */
      --bg-white: #ffffff;

      /* UI elements - Improved shadows for depth */
      --card-shadow: 0 10px 20px rgba(0, 0, 0, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
      --card-radius: 16px;
      --button-radius: 10px;
      --nav-height: 70px;
    }

    /* Base styles */
    body {
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text-dark);
      background-color: var(--bg-light);
      margin: 0;
      padding-top: calc(var(--nav-height) + 15px);
      line-height: 1.6;
    }

    /* Main background effect - Enhanced contrast */
    .page-background {
      position: fixed;
      z-index: -1;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 20%, rgba(26, 86, 219, 0.2), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(121, 40, 202, 0.2), transparent 40%),
        var(--bg-light);
      opacity: 0.9;
      /* Higher opacity for more visible gradient */
    }

    .ui.container {
      width: 100%;
      max-width: 1300px !important;
      padding: 0 25px;
    }

    /* Header navigation - Enhanced contrast */
    .main-navbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: var(--nav-height);
      background-color: var(--bg-white);
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.12);
      z-index: 100;
      display: flex;
      justify-content: center;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      /* Subtle border for definition */
    }

    .navbar-container {
      width: 100%;
      max-width: 1300px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
    }

    .nav-logo {
      display: flex;
      align-items: center;
    }

    .nav-logo img {
      height: 32px;
      cursor: pointer;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Navigation items - Enhanced contrast */
    .nav-item {
      position: relative;
      padding: 10px 15px;
      border-radius: var(--button-radius);
      color: var(--text-medium);
      font-weight: 500;
      text-decoration: none;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 7px;
    }

    .nav-item:hover {
      background-color: var(--primary-light);
      color: var(--primary);
    }

    .nav-item.active {
      background-color: var(--primary-light);
      color: var(--primary);
      font-weight: 600;
      border-bottom: 2px solid var(--primary);
      /* Added underline to active item */
    }

    /* Fix for icon alignment */
    .nav-item i {
      font-size: 1.1rem;
      width: 20px;
      /* Add fixed width */
      text-align: center;
      /* Center the icon */
      display: flex;
      /* Use flexbox */
      align-items: center;
      justify-content: center;
      height: 20px;
      /* Fixed height to match text */
      margin-right: 3px;
      /* Add some spacing */
    }

    /* Same fix for dropdown items */
    .dropdown-item i {
      font-size: 1.1rem;
      width: 20px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 20px;
    }

    /* Also apply to notification and user action items */
    .user-actions .nav-item i {
      width: 20px;
      text-align: center;
    }

    /* Fix vertical alignment in the dropdown items */
    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      color: var(--text-medium);
      text-decoration: none;
      transition: all 0.2s ease;
      line-height: 1;
      /* Ensures consistent height */
    }

    /* Dropdown menu - Enhanced contrast */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      position: absolute;
      top: 100%;
      left: 0;
      background-color: var(--bg-white);
      min-width: 220px;
      box-shadow: var(--card-shadow);
      border-radius: var(--card-radius);
      z-index: 1;
      padding: 8px 0;
      margin-top: 10px;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.2s ease;
      border: 1px solid rgba(0, 0, 0, 0.08);
      /* Subtle border for definition */
    }

    .dropdown:hover .dropdown-content {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      color: var(--text-medium);
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .dropdown-item:hover {
      background-color: var(--primary-light);
      color: var(--primary);
    }

    .dropdown-item.active {
      background-color: var(--primary-light);
      color: var(--primary);
      font-weight: 500;
      border-left: 3px solid var(--primary);
      /* Visual indicator for active dropdown item */
    }

    /* Notification badge - Enhanced contrast */
    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      height: 18px;
      min-width: 18px;
      line-height: 18px;
      text-align: center;
      font-size: 11px;
      font-weight: bold;
      padding: 0 4px;
      box-shadow: 0 2px 5px rgba(220, 38, 38, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.5);
      /* White border for extra pop */
    }

    /* User menu - Enhanced contrast */
    .user-menu {
      position: relative;
    }

    .profile-button {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: var(--button-radius);
      background: var(--dark-gradient);
      /* Darker gradient for better contrast */
      color: white;
      /* White text for maximum contrast */
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .profile-button:hover {
      box-shadow: 0 4px 12px rgba(26, 86, 219, 0.3);
      /* Added glow effect on hover */
    }

    .profile-button img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
      /* White border for profile image */
    }

    /* Notification dropdown special styles - Enhanced contrast */
    .notification-list {
      width: 300px;
      max-height: 400px;
      overflow-y: auto;
      padding: 5px 0;
    }

    .notification-item {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      transition: all 0.2s ease;
    }

    .notification-item:hover {
      background-color: var(--primary-light);
    }

    .notification-item:last-child {
      border-bottom: none;
    }

    .notification-content {
      font-size: 0.9rem;
      line-height: 1.4;
      color: var(--text-dark);
      /* Darker text for notifications */
    }

    .notification-time {
      display: block;
      font-size: 0.75rem;
      color: var(--text-light);
      margin-top: 3px;
    }

    .empty-notifications {
      text-align: center;
      padding: 20px;
      color: var(--text-light);
    }

    /* Mobile menu toggle - Enhanced contrast */
    .mobile-menu-toggle {
      display: none;
      font-size: 1.5rem;
      color: var(--primary);
      /* Changed to primary color for better visibility */
      cursor: pointer;
      background: none;
      border: none;
      padding: 5px;
    }

    /* Responsive styles */
    @media (max-width: 1024px) {
      .nav-item span {
        display: none;
      }

      .nav-item {
        padding: 10px;
      }
    }

    @media (max-width: 768px) {
      .main-navbar {
        height: 60px;
      }

      body {
        padding-top: 75px;
      }

      .mobile-menu-toggle {
        display: block;
      }

      .nav-links {
        position: fixed;
        top: 60px;
        left: 0;
        right: 0;
        background-color: var(--bg-white);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
        padding: 15px;
        flex-direction: column;
        align-items: flex-start;
        transform: translateY(-100%);
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }

      .nav-links.active {
        transform: translateY(0);
        opacity: 1;
        visibility: visible;
      }

      .nav-item {
        width: 100%;
        padding: 12px 15px;
      }

      .nav-item span {
        display: inline;
      }

      .dropdown-content {
        position: static;
        box-shadow: none;
        opacity: 1;
        visibility: visible;
        transform: none;
        margin: 5px 0 5px 25px;
        padding: 0;
        border-left: 2px solid var(--primary-light);
      }

      .profile-button span {
        display: none;
      }
    }
  </style>
</head>

<body>
  <div class="page-background"></div>

  <!-- Main Navigation -->
  {% if session["username"] %}
  <nav class="main-navbar">
    <div class="navbar-container">
      <div class="nav-logo">
        <img src="{{ url_for('static', filename='images/logo/chatboxes_stretch_png.png') }}" onclick="location.href='/'"
          alt="HSA Connect Logo" />
      </div>

      <button class="mobile-menu-toggle" id="menuToggle">
        <i class="bars icon"></i>
      </button>

      <div class="nav-links" id="navLinks">
        <a href="/" class="nav-item {% if request.path == '/' %}active{% endif %}">
          <i class="user icon"></i>
          <span>Hồ sơ của tôi</span>
        </a>

        {% if session["username"] %}
        <div class="dropdown">
          <a
            class="nav-item {% if '/connections' in request.path or '/members' in request.path or '/requests' in request.path %}active{% endif %}">
            <i class="sitemap icon"></i>
            <span>Kết nối</span>
            {% if requestCount > 0 %}
            <div class="notification-badge">{{ requestCount }}</div>
            {% endif %}
          </a>
          <div class="dropdown-content">
            <a href="/requests" class="dropdown-item {% if request.path == '/requests' %}active{% endif %}">
              <i class="user plus icon"></i>
              Lời mời kết nối
              {% if requestCount > 0 %}
              <div class="notification-badge">{{ requestCount }}</div>
              {% endif %}
            </a>
            <a href="/members" class="dropdown-item {% if request.path == '/members' %}active{% endif %}">
              <i class="users icon"></i>
              Tìm kiếm người dùng
            </a>
          </div>
        </div>
        {% endif %}

        <a href="/feed" class="nav-item {% if request.path == '/feed' %}active{% endif %}">
          <i class="newspaper outline icon"></i>
          <span>Bảng tin</span>
        </a>

        <div class="dropdown">
          <a
            class="nav-item {% if '/achievements' in request.path or '/leaderboard' in request.path %}active{% endif %}">
            <i class="bar chart icon"></i>
            <span>Thống kê</span>
          </a>
          <div class="dropdown-content">
            <a href="/achievements" class="dropdown-item {% if request.path == '/achievements' %}active{% endif %}">
              <i class="trophy icon"></i>
              Thành tựu của tôi
            </a>
            <a href="/leaderboard" class="dropdown-item {% if request.path == '/leaderboard' %}active{% endif %}">
              <i class="table icon"></i>
              Bảng xếp hạng
            </a>
          </div>
        </div>

        <div class="dropdown">
          <a class="nav-item {% if '/quizzes' in request.path or '/flashcards' in request.path %}active{% endif %}">
            <i class="graduation cap icon"></i>
            <span>Học tập</span>
          </a>
          <div class="dropdown-content">
            <a href="/quizzes" class="dropdown-item {% if '/quizzes' in request.path %}active{% endif %}">
              <i class="question icon"></i>
              Quizzes
            </a>
            <a href="/flashcards" class="dropdown-item {% if '/flashcards' in request.path %}active{% endif %}">
              <i class="clone outline icon"></i>
              Flash cards
            </a>
          </div>
        </div>

        <a href="/chat" class="nav-item {% if request.path == '/chat' %}active{% endif %}">
          <i class="comment alternate outline icon"></i>
          <span>Trò chuyện</span>
        </a>
      </div>

      <div class="user-actions">
        {% if session["username"] %}

        {% if "admin" in session and session["admin"] %}
        <div class="dropdown">
          <a class="nav-item">
            <i class="shield alternate icon"></i>
          </a>
          <div class="dropdown-content">
            <a href="{{ url_for('show_staff_requests') }}"
              class="dropdown-item {% if '/staff_requests' in request.path %}active{% endif %}">
              <i class="user cog icon"></i>
              Yêu cầu nhân viên
            </a>
            <a href="#" class="dropdown-item">
              <i class="chart line icon"></i>
              Thống kê hệ thống
            </a>
            <a href="#" class="dropdown-item">
              <i class="cog icon"></i>
              Cài đặt hệ thống
            </a>
          </div>
        </div>
        {% endif %}

        <div class="dropdown">
          <a class="nav-item">
            <i class="bell icon"></i>
            {% if notifications|length > 0 %}
            <div class="notification-badge">{{ notifications|length }}</div>
            {% endif %}
          </a>
          <div class="dropdown-content notification-list">
            {% if notifications|length > 0 %}
            {% for notification in notifications %}
            <a href="{{ notification[2] }}" class="notification-item">
              <div class="notification-content">{{ notification[0] }}</div>
              <span class="notification-time">{{ notification[1] }}</span>
            </a>
            {% endfor %}
            {% else %}
            <div class="empty-notifications">
              <i class="check circle outline icon"></i>
              <p>Không có thông báo mới</p>
            </div>
            {% endif %}
          </div>
        </div>

        <div class="dropdown user-menu">
          <div class="profile-button">
            <i class="user circle icon"></i>
            <span>{{ session["username"] }}</span>
          </div>
          <div class="dropdown-content">
            <a href="/profile/{{ session['username'] }}" class="dropdown-item">
              <i class="id card outline icon"></i>
              Xem hồ sơ
            </a>
            <a href="/edit-profile" class="dropdown-item {% if request.path == '/edit-profile' %}active{% endif %}">
              <i class="cogs icon"></i>
              Cài đặt hồ sơ
            </a>
            <a href="#" class="dropdown-item">
              <i class="paint brush icon"></i>
              Tùy chỉnh giao diện
            </a>
            <a href="/logout" class="dropdown-item">
              <i class="sign-out alternate icon"></i>
              Đăng xuất
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </nav>
  {% endif %}
  <div class="ui container">
    {% block content %}{% endblock %}
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Mobile menu toggle
      const menuToggle = document.getElementById('menuToggle');
      const navLinks = document.getElementById('navLinks');

      if (menuToggle) {
        menuToggle.addEventListener('click', function () {
          if (navLinks.classList.contains('active')) {
            navLinks.classList.remove('active');
          } else {
            navLinks.classList.add('active');
          }
        });
      }

      // Close dropdowns when clicking outside
      document.addEventListener('click', function (event) {
        const clickInsideNav = navLinks.contains(event.target) || menuToggle.contains(event.target);
        if (!clickInsideNav && navLinks.classList.contains('active')) {
          navLinks.classList.remove('active');
        }
      });
    });
  </script>
</body>

</html>