<meta property="og:title" content="HSA Connect | Đăng ký" />
<meta property="og:image" content="https://i.ibb.co/hL3WsKP/full-logo-jpg.jpg" />
<meta property="og:description" content="Mạng lưới sinh viên. Kết nối sinh viên trong và ngoài lớp học." />

{% extends "base.html" %}
{% block title %}Đăng ký{% endblock %}
{% block content %}

<div class="ui two column stackable grid" style="margin-top: 2%;">
  <div class="column">
    <div class="ui fluid card" style="box-shadow: 0 10px 25px rgba(0,0,0,0.1); border-radius: 15px; overflow: hidden;">
      <div class="content"
        style="background: linear-gradient(135deg, #6e8efb, #a777e3); padding: 2rem; text-align: center;">
        <img src="https://i.ibb.co/hL3WsKP/full-logo-jpg.jpg" class="ui centered small image"
          style="border-radius: 10px; margin-bottom: 1rem;">
        <h2 class="ui header" style="color: white; font-size: 2rem; margin-top: 0;">Tham gia HSA Connect</h2>
        <p style="color: rgba(255,255,255,0.8);">Đăng ký tài khoản mới để kết nối với cộng đồng sinh viên</p>
      </div>

      <div class="content" style="padding: 2rem 2.5rem;">
        <form action="/register" method="POST" class="ui large form">
          {% if errors %}
          <div class="ui negative message" style="border-radius: 8px; box-shadow: none;">
            <div class="header">Thông tin không hợp lệ</div>
            {% for item in errors %}
            <p>{{ item }}</p>
            {% endfor %}
          </div>
          {% endif %}

          {% if "register" in notifications %}
          <div class="ui positive message" style="border-radius: 8px; box-shadow: none;">
            <div class="header">Thành công</div>
            <p>Tài khoản đã được tạo. Bạn có thể đăng nhập ngay bây giờ.</p>
          </div>
          {% endif %}

          <div class="required field">
            <label style="font-weight: 500; color: #555;">Tên đăng nhập</label>
            <div class="ui left icon input" style="margin-top: 0.5rem;">
              <i class="user icon"></i>
              <input autocomplete="username" name="username_input" id="username_input" type="text"
                placeholder="Nhập tên đăng nhập" value="{{details[0]}}" oninput="CheckUsernameExists();"
                style="border-radius: 8px;">
            </div>
            <div class="ui red message" id="usernameError"
              style="display: none; margin-top: 0.5rem; border-radius: 8px;"></div>
          </div>

          <div class="required field">
            <label style="font-weight: 500; color: #555;">Họ và tên</label>
            <div class="ui left icon input" style="margin-top: 0.5rem;">
              <i class="id card icon"></i>
              <input autocomplete="name" name="fullname_input" type="text" placeholder="Nhập họ và tên đầy đủ"
                value="{{details[1]}}" style="border-radius: 8px;">
            </div>
          </div>

          <div class="required field">
            <label style="font-weight: 500; color: #555;">Địa chỉ email</label>
            <div class="ui left icon input" style="margin-top: 0.5rem;">
              <i class="envelope icon"></i>
              <input autocomplete="email" name="email_input" type="email" placeholder="Nhập địa chỉ email"
                value="{{details[2]}}" style="border-radius: 8px;">
            </div>
          </div>

          <div class="required field">
            <label style="font-weight: 500; color: #555;">Mật khẩu</label>
            <div class="ui left icon input" style="margin-top: 0.5rem;">
              <i class="lock icon"></i>
              <input name="psw_input" type="password" placeholder="Nhập mật khẩu" style="border-radius: 8px;">
            </div>
          </div>

          <div class="required field">
            <label style="font-weight: 500; color: #555;">Xác nhận mật khẩu</label>
            <div class="ui left icon input" style="margin-top: 0.5rem;">
              <i class="lock icon"></i>
              <input name="psw_input_check" type="password" placeholder="Nhập lại mật khẩu" style="border-radius: 8px;">
            </div>
          </div>

          <div class="field" style="margin-top: 1.5rem;">
            <label style="font-weight: 500; color: #555; margin-bottom: 0.8rem;">Chọn loại tài khoản:</label>
            <div class="ui form">
              <div class="inline fields" style="margin: 0;">
                <div class="field">
                  <div class="ui radio checkbox">
                    <input type="radio" name="optradio" value="student" checked>
                    <label style="font-weight: 400; color: #666;">Sinh viên</label>
                  </div>
                </div>
                <div class="field">
                  <div class="ui radio checkbox">
                    <input type="radio" name="optradio" value="pending_staff">
                    <label style="font-weight: 400; color: #666;">Giảng viên</label>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="required field" style="margin-top: 1.5rem;">
            <div class="ui checkbox">
              <input type="checkbox" name="terms">
              <label style="font-weight: 400; color: #666;">
                Tôi đã đọc và đồng ý với <a href="/terms" style="color: #a777e3;">Điều khoản dịch vụ</a>
              </label>
            </div>
          </div>

          <button type="submit" class="ui fluid large submit button" style="background: linear-gradient(135deg, #6e8efb, #a777e3); 
                           color: white; margin-top: 2rem; height: 3.5rem; 
                           border-radius: 8px; font-weight: 500; font-size: 1.1rem;
                           box-shadow: 0 5px 15px rgba(167, 119, 227, 0.4);">
            Đăng ký
          </button>
        </form>
      </div>

      <div class="extra content"
        style="background-color: #f9f9f9; padding: 1.5rem; text-align: center; border-top: none;">
        <p style="color: #666; margin: 0;">
          Đã có tài khoản?
          <a href="/login" style="color: #6e8efb; font-weight: 500;">Đăng nhập ngay</a>
        </p>
      </div>
    </div>
  </div>

  <div class="column hide-on-mobile" style="display: flex; align-items: center; justify-content: center;">
    <div style="text-align: center; padding: 2rem;">
      <img src="https://i.ibb.co/hL3WsKP/full-logo-jpg.jpg" class="ui large image"
        style="max-width: 90%; border-radius: 15px; box-shadow: 0 15px 30px rgba(0,0,0,0.15);">
      <h2 class="ui header" style="margin-top: 2rem; color: #333; font-size: 1.8rem;">Lợi ích khi tham gia HSA Connect
      </h2>
      <div class="ui list" style="text-align: left; margin-top: 1.5rem; font-size: 1.1rem;">
        <div class="item" style="padding: 0.5rem 0;">
          <i class="check circle icon" style="color: #6e8efb;"></i>
          <div class="content" style="color: #555;">Kết nối với sinh viên và giảng viên</div>
        </div>
        <div class="item" style="padding: 0.5rem 0;">
          <i class="check circle icon" style="color: #6e8efb;"></i>
          <div class="content" style="color: #555;">Truy cập tài liệu học tập và bài kiểm tra</div>
        </div>
        <div class="item" style="padding: 0.5rem 0;">
          <i class="check circle icon" style="color: #6e8efb;"></i>
          <div class="content" style="color: #555;">Thảo luận chuyên ngành với cộng đồng</div>
        </div>
        <div class="item" style="padding: 0.5rem 0;">
          <i class="check circle icon" style="color: #6e8efb;"></i>
          <div class="content" style="color: #555;">Nhận thông báo về sự kiện quan trọng</div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  @media only screen and (max-width: 767px) {
    .hide-on-mobile {
      display: none !important;
    }
  }

  .ui.checkbox input:checked~label:after {
    color: #6e8efb;
  }

  .ui.radio.checkbox input:checked~.box:after,
  .ui.radio.checkbox input:checked~label:after {
    background-color: #6e8efb;
  }
</style>

<script>
  function CheckUsernameExists() {
    var input = document.getElementById("username_input");
    var error = document.getElementById("usernameError");

    // Don't check if username is empty
    if (input.value.trim() === "") {
      error.style.display = "none";
      return;
    }

    var xhttp = new XMLHttpRequest();

    xhttp.onreadystatechange = function () {
      if (this.readyState === 4 && this.status === 200) {
        if (this.response == "True") {
          error.innerHTML = "Tên đăng nhập đã được sử dụng.";
          error.style.display = "block";
        } else {
          error.innerHTML = "";
          error.style.display = "none";
        }
      }
    };

    xhttp.open("GET", "user_exists?username=" + input.value);
    xhttp.send();
  }
</script>

{% endblock %}