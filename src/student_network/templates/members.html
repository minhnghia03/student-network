<meta property="og:title" content="HSA Connect | Thành viên" />
<meta property="og:image" content="https://i.ibb.co/hL3WsKP/full-logo-jpg.jpg" />
<meta property="og:description" content="Mạng lưới sinh viên. Kết nối sinh viên trong và ngoài lớp học." />

{% extends "base.html" %}
{% block title %}Thành viên{% endblock %}
{% block content %}

<style>
  /* Color variables */
  :root {
    --primary: #6e8efb;
    --primary-light: rgba(110, 142, 251, 0.1);
    --primary-hover: rgba(110, 142, 251, 0.2);
    --secondary: #a777e3;
    --secondary-light: rgba(167, 119, 227, 0.1);
    --secondary-hover: rgba(167, 119, 227, 0.2);
    --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
    --light-gradient: linear-gradient(135deg, rgba(110, 142, 251, 0.1), rgba(167, 119, 227, 0.1));
    --green: #28a745;
    --green-light: rgba(40, 167, 69, 0.1);
    --green-hover: rgba(40, 167, 69, 0.2);
    --teal: #20c997;
    --teal-light: rgba(32, 201, 151, 0.1);
    --purple: #a777e3;
    --purple-light: rgba(167, 119, 227, 0.1);
    --text-dark: #333;
    --text-medium: #555;
    --text-light: #888;
    --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    --card-radius: 15px;
    --input-radius: 8px;
    --button-radius: 8px;
  }
  
  /* Container */
  .members-container {
    max-width: 1100px;
    margin: 30px auto;
    padding: 0 20px;
  }

  /* Header */
  .members-header {
    text-align: center;
    margin-bottom: 30px;
  }

  .members-title {
    font-size: 2.2rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 10px;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .members-subtitle {
    font-size: 1.1rem;
    color: #666;
    max-width: 600px;
    margin: 0 auto;
  }

  /* Search card */
  .search-card {
    background: white;
    border-radius: var(--card-radius);
    box-shadow: var(--card-shadow);
    overflow: hidden;
    margin-bottom: 30px;
  }

  .card-header {
    background: var(--light-gradient);
    padding: 20px 25px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
  }

  .card-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-dark);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card-title i {
    color: var(--primary);
  }

  .card-body {
    padding: 25px;
  }

  /* Search inputs */
  .search-main {
    margin-bottom: 25px;
    position: relative;
  }

  .search-icon {
    position: absolute;
    top: 50%;
    left: 15px;
    transform: translateY(-50%);
    color: var(--text-light);
    font-size: 1.2rem;
  }

  .search-input {
    width: 100%;
    padding: 14px 14px 14px 45px;
    border-radius: var(--input-radius);
    border: 1px solid rgba(0, 0, 0, 0.1);
    font-size: 1rem;
    transition: all 0.2s ease;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  }

  .search-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-light);
    outline: none;
  }

  .search-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 10px;
  }

  .search-filter {
    flex: 1;
    min-width: 200px;
    position: relative;
  }

  .search-filter-label {
    position: absolute;
    top: -10px;
    left: 15px;
    background: white;
    padding: 0 8px;
    font-size: 0.8rem;
    font-weight: 600;
    border-radius: 10px;
    z-index: 1;
  }

  .label-hobby {
    color: var(--teal);
  }

  .label-interest {
    color: var(--purple);
  }

  .filter-input {
    width: 100%;
    padding: 12px 15px;
    border-radius: var(--input-radius);
    border: 1px solid rgba(0, 0, 0, 0.1);
    font-size: 0.95rem;
    transition: all 0.2s ease;
  }

  .hobby-input:focus {
    border-color: var(--teal);
    box-shadow: 0 0 0 3px var(--teal-light);
    outline: none;
  }

  .interest-input:focus {
    border-color: var(--purple);
    box-shadow: 0 0 0 3px var(--purple-light);
    outline: none;
  }

  .filter-connector {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    background-color: var(--green-light);
    color: var(--green);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    font-weight: bold;
    align-self: center;
    margin: 0 5px;
  }

  /* Results section */
  .results-section {
    background: white;
    border-radius: var(--card-radius);
    box-shadow: var(--card-shadow);
    overflow: hidden;
    margin-top: 30px;
  }

  .results-header {
    background: var(--light-gradient);
    padding: 15px 25px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .results-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-dark);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .results-body {
    padding: 0;
    max-height: 500px;
    overflow-y: auto;
  }

  /* User list */
  .user-list {
    margin: 0;
    padding: 0;
    list-style-type: none;
  }

  .user-item {
    display: flex;
    align-items: center;
    padding: 15px 25px;
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }

  .user-item:hover {
    background-color: var(--primary-light);
  }

  .user-item:last-child {
    border-bottom: none;
  }

  .user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    object-fit: cover;
    margin-right: 15px;
  }

  .user-info {
    flex: 1;
  }

  .user-name {
    font-weight: 600;
    color: var(--primary);
    text-decoration: none;
    font-size: 1.05rem;
  }

  .user-name:hover {
    text-decoration: underline;
  }

  .user-meta {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-top: 3px;
  }

  .meta-highlight {
    font-weight: 600;
    color: var(--text-medium);
  }

  .empty-results {
    padding: 30px;
    text-align: center;
    color: var(--text-light);
  }

  .empty-results i {
    font-size: 3rem;
    margin-bottom: 15px;
    opacity: 0.3;
  }

  .empty-results-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--text-medium);
    margin-bottom: 5px;
  }

  /* Results count badge */
  .results-count {
    background-color: var(--primary-light);
    color: var(--primary);
    font-size: 0.9rem;
    font-weight: 600;
    padding: 5px 10px;
    border-radius: 20px;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .search-filters {
      flex-direction: column;
    }
    
    .filter-connector {
      align-self: flex-start;
      margin: -5px 0;
    }
  }
</style>

<div class="members-container">
  <div class="members-header">
    <h1 class="members-title">Khám phá Thành viên</h1>
    <p class="members-subtitle">Tìm kiếm và kết nối với các thành viên HSA Connect dựa trên sở thích và mối quan tâm chung</p>
  </div>

  <div class="search-card">
    <div class="card-header">
      <h2 class="card-title">
        <i class="search icon"></i>
        Tìm kiếm Thành viên
      </h2>
    </div>
    
    <div class="card-body">
      <div class="search-main">
        <i class="users icon search-icon"></i>
        <input 
          type="text" 
          id="userInput" 
          class="search-input" 
          placeholder="Nhập tên người dùng để tìm kiếm..." 
          oninput="SearchUser();"
        >
      </div>
      
      <div class="search-filters">
        <div class="search-filter">
          <div class="search-filter-label label-hobby">Sở thích</div>
          <input 
            type="text" 
            id="hobbyInput" 
            class="filter-input hobby-input" 
            placeholder="Tìm kiếm theo sở thích chung..." 
            oninput="SearchUser();"
          >
        </div>
        
        <div class="filter-connector">VÀ</div>
        
        <div class="search-filter">
          <div class="search-filter-label label-interest">Mối quan tâm</div>
          <input 
            type="text" 
            id="interestInput" 
            class="filter-input interest-input" 
            placeholder="Tìm kiếm theo mối quan tâm chung..." 
            oninput="SearchUser();"
          >
        </div>
      </div>
    </div>
  </div>

  <div class="results-section">
    <div class="results-header">
      <h3 class="results-title">
        <i class="list icon"></i>
        Kết quả tìm kiếm
      </h3>
      <div class="results-count" id="resultsCount">0 thành viên</div>
    </div>
    
    <div class="results-body">
      <div id="users" class="user-list">
        <!-- Search results will appear here -->
        <div class="empty-results">
          <i class="search icon"></i>
          <div class="empty-results-title">Bắt đầu tìm kiếm</div>
          <p>Nhập thông tin tìm kiếm để xem các thành viên</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function SearchUser() {
    const userContainer = document.getElementById("users");
    const username = document.getElementById("userInput").value;
    const hobby = document.getElementById("hobbyInput").value;
    const interest = document.getElementById("interestInput").value;
    const resultsCountElement = document.getElementById("resultsCount");
    
    // Show empty state if all fields are empty
    if (username === "" && hobby === "" && interest === "") {
      userContainer.innerHTML = `
        <div class="empty-results">
          <i class="search icon"></i>
          <div class="empty-results-title">Bắt đầu tìm kiếm</div>
          <p>Nhập thông tin tìm kiếm để xem các thành viên</p>
        </div>
      `;
      resultsCountElement.textContent = "0 thành viên";
      return;
    }
    
    // Show loading indicator
    userContainer.innerHTML = `
      <div class="empty-results">
        <i class="spinner loading icon"></i>
        <div class="empty-results-title">Đang tìm kiếm...</div>
      </div>
    `;
    
    // Fetch results
    fetch(`search_query?chars=${encodeURIComponent(username)}&hobby=${encodeURIComponent(hobby)}&interest=${encodeURIComponent(interest)}`)
      .then(response => response.json())
      .then(users => {
        if (users.length === 0) {
          userContainer.innerHTML = `
            <div class="empty-results">
              <i class="frown outline icon"></i>
              <div class="empty-results-title">Không tìm thấy kết quả</div>
              <p>Thử tìm kiếm với từ khóa khác</p>
            </div>
          `;
          resultsCountElement.textContent = "0 thành viên";
        } else {
          userContainer.innerHTML = '';
          
          users.forEach(user => {
            let extraInfo = '';
            const hasHobbyOrInterest = (user[1] != null && hobby !== "") || (user[2] != null && interest !== "");
            
            if (user[1] != null && hobby !== "") {
              extraInfo += `<div class="user-meta">Sở thích: <span class="meta-highlight">${user[1]}</span></div>`;
            }
            
            if (user[2] != null && interest !== "") {
              extraInfo += `<div class="user-meta">Mối quan tâm: <span class="meta-highlight">${user[2]}</span></div>`;
            }
            
            if (!hasHobbyOrInterest) {
              extraInfo = `<div class="user-meta">Đang học ${user[4]}</div>`;
            }
            
            const html = `
              <div class="user-item">
                <img class="user-avatar" src="${user[3]}" alt="${user[0]}">
                <div class="user-info">
                  <a class="user-name" href="./profile/${user[0]}">${user[0]}</a>
                  ${extraInfo}
                </div>
              </div>
            `;
            
            userContainer.innerHTML += html;
          });
          
          resultsCountElement.textContent = `${users.length} thành viên`;
        }
      })
      .catch(error => {
        console.error('Error fetching search results:', error);
        userContainer.innerHTML = `
          <div class="empty-results">
            <i class="exclamation triangle icon"></i>
            <div class="empty-results-title">Đã xảy ra lỗi</div>
            <p>Không thể tải kết quả tìm kiếm. Vui lòng thử lại sau.</p>
          </div>
        `;
        resultsCountElement.textContent = "0 thành viên";
      });
  }
</script>

{% endblock %}